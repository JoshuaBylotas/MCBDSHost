# .NET 10 MSIX Publish Limitation

## Problem

When attempting to publish a .NET 10 MAUI project for MSIX packaging using `dotnet publish`, you encounter:

```
error NU1102: Unable to find package Microsoft.NETCore.App.Runtime.Mono.win-x64 with version (= 10.0.1)
  - Found 113 version(s) in nuget.org [ Nearest version: 9.0.0-preview.7.24405.7 ]
  - Found 0 version(s) in Microsoft Visual Studio Offline Packages
  - Found 0 version(s) in C:\Program Files\dotnet\library-packs
```

## Root Cause

**.NET 10 is currently in preview/development**, and the required runtime packages for MSIX publish operations are not yet available on NuGet.org or in the SDK. Specifically:

- `Microsoft.NETCore.App.Runtime.Mono.win-x64` version 10.0.1 doesn't exist yet
- The nearest available version is for .NET 9 preview
- The `dotnet publish` command cannot create MSIX packages without these runtime components

### Why This Happens

When you run `dotnet publish` with MSIX packaging parameters:
```powershell
dotnet publish -p:WindowsPackageType=MSIX -p:GenerateAppxPackageOnBuild=true
```

The publish process requires the full .NET runtime, including Mono runtime components for MAUI. For .NET 10, these packages are not yet published to NuGet.

## Solution

**Use Visual Studio 2022's built-in MSIX packaging instead of `dotnet publish`.**

### Method 1: Visual Studio Publish Wizard (Recommended)

1. **Build the solution first:**
   ```powershell
   .\BuildAndPublish.ps1 -Configuration Release -CreatePackage
   ```
   (This will build and prepare everything, then guide you to use Visual Studio)

2. **Open Visual Studio 2022**

3. **Right-click on `MCBDS.PublicUI` project**

4. **Select: Publish ? Create App Packages...**

5. **In the wizard:**
   - Choose **"Microsoft Store using a new app name"** or existing app
   - Sign in to your Partner Center account
   - Select your app: **"MCBDS Manager"**
   - Choose architecture(s): **x64**, x86, or ARM64
   - Set configuration to **Release**
   - Click **Create**

6. **Package location:**
   ```
   MCBDS.PublicUI\AppPackages\MCBDS.PublicUI_<version>_Test\
   ```

### Method 2: Using MSBuild Directly (Advanced)

If you need command-line packaging, use MSBuild instead of dotnet publish:

```powershell
# Build for package
msbuild MCBDS.PublicUI\MCBDS.PublicUI.csproj `
    /t:Publish `
    /p:Configuration=Release `
    /p:TargetFramework=net10.0-windows10.0.19041.0 `
    /p:RuntimeIdentifier=win-x64 `
    /p:WindowsPackageType=MSIX `
    /p:AppxPackageDir="AppPackages\" `
    /p:AppxBundle=Always `
    /p:UapAppxPackageBuildMode=StoreUpload
```

**Note:** This may still have limitations with .NET 10 preview.

## Workflow

### Recommended Build & Package Workflow

```powershell
# 1. Build and verify (automated)
.\BuildAndPublish.ps1 -Configuration Release -CreatePackage

# 2. Use Visual Studio to create MSIX
#    (Follow the on-screen instructions)

# 3. Verify the package
.\VerifyMSIXAssets.ps1 -Configuration Release -RuntimeIdentifier win-x64

# 4. Test locally
Add-AppxPackage -Path "MCBDS.PublicUI\AppPackages\...\MCBDS.PublicUI_<version>_x64.msix"
```

## Why Visual Studio Works

Visual Studio 2022 uses:
- **Built-in packaging tools** that don't rely on NuGet packages
- **SDK-bundled runtimes** from the .NET 10 SDK installation
- **MakeAppx.exe** and other Windows SDK tools directly
- **Different packaging pipeline** than `dotnet publish`

The Visual Studio packaging process:
1. Uses the already-built binaries from the build output
2. Packages them with the Windows SDK tools
3. Signs the package
4. Creates the MSIX bundle

This bypasses the NuGet package dependency that `dotnet publish` has.

## When Will dotnet publish Work?

The `dotnet publish` command will work for MSIX packaging when:
- .NET 10 reaches RTM (Release to Manufacturing)
- Microsoft publishes the required runtime packages to NuGet.org
- The .NET SDK 10.0 final release includes all packaging components

**Estimated timeline:** When .NET 10 RTM is released (likely November 2025 based on .NET release cadence)

## Alternative: Self-Contained Publish

If you need command-line publish, you can try self-contained mode (includes runtime):

```powershell
dotnet publish MCBDS.PublicUI\MCBDS.PublicUI.csproj `
    -c Release `
    -f net10.0-windows10.0.19041.0 `
    -r win-x64 `
    --self-contained true `
    -p:PublishSingleFile=false
```

**However:** This still won't create an MSIX package, just a publishable folder. You'd need to manually package it.

## Updated Scripts

The `BuildAndPublish.ps1` script has been updated to:
- ? Build the project successfully
- ? Verify all dependencies
- ? Fix assets file issues
- ? Prepare for packaging
- ?? Guide you to use Visual Studio for MSIX creation
- ? No longer attempts `dotnet publish` (which fails)

## Verification Before Packaging

Always run these checks before creating the MSIX:

```powershell
# 1. Verify build is clean
.\BuildAndPublish.ps1 -Configuration Release

# 2. Check assets are present
.\VerifyMSIXAssets.ps1 -Configuration Release -RuntimeIdentifier win-x64

# 3. Run pre-publish check
.\PrePublishCheck.ps1 -Configuration Release
```

## Summary

| Method | .NET 10 Support | Recommended |
|--------|----------------|-------------|
| `dotnet publish` with MSIX | ? Not working (missing packages) | ? No |
| Visual Studio Publish | ? Works | ? **Yes** |
| MSBuild directly | ?? May work | ?? Advanced users only |
| Self-contained publish | ?? Folder only, no MSIX | ? No |

## Quick Reference

**Build ? Package ? Submit workflow:**

```powershell
# Step 1: Build and prepare
.\BuildAndPublish.ps1 -Configuration Release -CreatePackage

# Step 2: Open Visual Studio
# Right-click MCBDS.PublicUI ? Publish ? Create App Packages

# Step 3: Verify
.\VerifyMSIXAssets.ps1

# Step 4: Test locally
# Install the .msix file from AppPackages folder

# Step 5: Submit to Partner Center
# Upload the .msixupload file
```

---

**Last Updated:** January 12, 2026  
**Status:** Visual Studio packaging is the only supported method for .NET 10 MSIX creation  
**Tracking:** This limitation will be resolved when .NET 10 RTM is released
