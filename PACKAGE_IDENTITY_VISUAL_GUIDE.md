# Package Identity Flow - Development vs Store

## The Problem Explained Visually

```
????????????????????????????????????????????????????????????????????????????
?                      YOUR CURRENT SITUATION                               ?
?                          (INCORRECT)                                      ?
????????????????????????????????????????????????????????????????????????????

1. Package.appxmanifest                     ? Correct Store Identity
   ???????????????????????????????????????
   ? Name: 50677...MCBDSManager          ?
   ? Publisher: CN=5DB9918C-...          ?  ? From Partner Center
   ? Version: 1.0.16.1                   ?
   ???????????????????????????????????????
                    ?
                    ? Build with CreateMSIXWithWindowsSDK.ps1
                    ?
2. Build & Package
   ???????????????????????????????????????
   ? Build output created                ?
   ? MSIX package created                ?
   ???????????????????????????????????????
                    ?
                    ? Sign with development certificate
                    ?
3. Sign with Development Certificate       ? PROBLEM HERE!
   ???????????????????????????????????????
   ? Certificate: CN=MC-BDS              ?  ? Your dev cert
   ? Thumbprint: B97A80AD...             ?
   ?                                     ?
   ? This OVERWRITES the Publisher!      ?
   ???????????????????????????????????????
                    ?
                    ?
4. Final Package Identity                  ? WRONG!
   ???????????????????????????????????????
   ? Publisher: CN=MC-BDS                ?  ? Changed!
   ? Hash: _47q1101p6hvwy               ?  ? Wrong hash!
   ? Package Family Name:                ?
   ?   50677...Manager_47q1101p6hvwy    ?  ? Doesn't match Store!
   ???????????????????????????????????????
                    ?
                    ? Upload to Partner Center
                    ?
5. Partner Center Validation               ? REJECTED!
   ???????????????????????????????????????
   ? Expected: CN=5DB9918C-...           ?
   ? Got:      CN=MC-BDS                 ?
   ?                                     ?
   ? Expected: ..._n8ws8gp0q633w         ?
   ? Got:      ..._47q1101p6hvwy         ?
   ?                                     ?
   ? ? IDENTITY MISMATCH!               ?
   ???????????????????????????????????????


????????????????????????????????????????????????????????????????????????????
?                      THE CORRECT APPROACH                                 ?
?                  (Visual Studio ? Store)                                  ?
????????????????????????????????????????????????????????????????????????????

1. Package.appxmanifest                     ? Correct Store Identity
   ???????????????????????????????????????
   ? Name: 50677...MCBDSManager          ?
   ? Publisher: CN=5DB9918C-...          ?  ? From Partner Center
   ? Version: 1.0.17.0                   ?  ? Incremented!
   ???????????????????????????????????????
                    ?
                    ? Visual Studio ? Create App Packages
                    ?
2. Visual Studio Build
   ???????????????????????????????????????
   ? Build for x64, x86, ARM64           ?
   ? Create bundle                        ?
   ? Sign with test cert OR unsigned      ?  ? Temp signing only!
   ???????????????????????????????????????
                    ?
                    ?
3. Create .msixupload Bundle                ? Ready for Store
   ???????????????????????????????????????
   ? File: MCBDS...msixupload            ?
   ? Contains: x64, x86, ARM64           ?
   ? Signed: Test cert (will be removed) ?
   ???????????????????????????????????????
                    ?
                    ? Upload to Partner Center
                    ?
4. Partner Center Validation                ? Passed!
   ???????????????????????????????????????
   ? Package structure: ? Valid          ?
   ? Assets: ? Present                   ?
   ? Identity: ? Matches (manifest)      ?
   ? Ready for certification              ?
   ???????????????????????????????????????
                    ?
                    ? Microsoft re-signs during certification
                    ?
5. Microsoft Store Signing                  ? Correct Identity!
   ???????????????????????????????????????
   ? Microsoft removes temp signature    ?
   ? Microsoft signs with Store cert:    ?
   ?   Publisher: CN=5DB9918C-...        ?
   ?   Hash: _n8ws8gp0q633w              ?
   ?                                     ?
   ? Package Family Name:                ?
   ?   50677...Manager_n8ws8gp0q633w    ?  ? Correct!
   ???????????????????????????????????????
                    ?
                    ?
6. Certification & Publication              ? SUCCESS!
   ???????????????????????????????????????
   ? Package tested                      ?
   ? No identity mismatch                ?
   ? Published to Store                  ?
   ???????????????????????????????????????


????????????????????????????????????????????????????????????????????????????
?                 TWO DIFFERENT WORKFLOWS                                   ?
????????????????????????????????????????????????????????????????????????????

?????????????????????????????????      ?????????????????????????????????
?  DEVELOPMENT / LOCAL TESTING  ?      ?   MICROSOFT STORE SUBMISSION  ?
?????????????????????????????????      ?????????????????????????????????

Purpose:                                Purpose:
• Test on your PC                       • Public distribution
• Share with beta testers               • Automatic updates
• Sideload on devices                   • Store features (ratings, etc.)

Method:                                 Method:
• CreateMSIXWithWindowsSDK.ps1          • Visual Studio ? Create Packages
• Sign with dev cert                    • Don't sign manually
• CN=MC-BDS                             • Microsoft signs it

Package Family Name:                    Package Family Name:
• ..._47q1101p6hvwy                     • ..._n8ws8gp0q633w

File Type:                              File Type:
• .msix (signed by you)                 • .msixupload (bundle)

Installation:                           Installation:
• InstallCertAndMSIX.ps1                • Microsoft Store app
• Add-AppxPackage                       • Automatic

Updates:                                Updates:
• Manual reinstall                      • Automatic via Store


????????????????????????????????????????????????????????????????????????????
?              WHY THE PACKAGE FAMILY NAME CHANGES                          ?
????????????????????????????????????????????????????????????????????????????

Package Family Name = {PackageName}_{PublisherHash}

Development Certificate:
??????????????????????????????????????????????????????
? Subject: CN=MC-BDS                                 ?
?           ??> Hash Algorithm                       ?
?                ??> _47q1101p6hvwy                  ?
?                                                    ?
? PackageFamilyName =                                ?
?   50677PinecrestConsultants.MCBDSManager_          ?
?   47q1101p6hvwy                                    ?
??????????????????????????????????????????????????????

Store Certificate:
??????????????????????????????????????????????????????
? Publisher: CN=5DB9918C-386B-4DCF-98CB-FF6BA76EA289 ?
?              ??> Hash Algorithm                    ?
?                   ??> _n8ws8gp0q633w               ?
?                                                    ?
? PackageFamilyName =                                ?
?   50677PinecrestConsultants.MCBDSManager_          ?
?   n8ws8gp0q633w                                    ?
??????????????????????????????????????????????????????

The hash is DIFFERENT because the Publisher/Subject is DIFFERENT!


????????????????????????????????????????????????????????????????????????????
?                         KEY TAKEAWAYS                                     ?
????????????????????????????????????????????????????????????????????????????

? DO:
  • Use Visual Studio ? Create App Packages ? Microsoft Store
  • Upload .msixupload files to Partner Center
  • Let Microsoft sign packages during certification
  • Increment version for each submission

? DON'T:
  • Manually sign packages for Store submission
  • Use CreateMSIXWithWindowsSDK.ps1 for Store (that's for dev testing)
  • Upload individual .msix files to Store
  • Resubmit the same version number

The identity mismatch happens because:
1. Your dev certificate has a different Subject (CN=MC-BDS)
2. This creates a different hash (_47q1101p6hvwy)
3. The Store expects the hash from its certificate (_n8ws8gp0q633w)
4. Solution: Let Microsoft sign it instead of signing it yourself


????????????????????????????????????????????????????????????????????????????
?                      CERTIFICATE COMPARISON                               ?
????????????????????????????????????????????????????????????????????????????

??????????????????????????????????????????????????????????????????????????
?                     DEVELOPMENT CERTIFICATE                             ?
??????????????????????????????????????????????????????????????????????????
Subject:     CN=MC-BDS
Thumbprint:  B97A80AD152EF3F18075E8F6B31A219112319F2B
Hash:        _47q1101p6hvwy
Issuer:      Self-signed
Valid For:   Your PC, sideloading, testing
Stored In:   MCBDS.PublicUI_TemporaryKey.pfx

??????????????????????????????????????????????????????????????????????????
?                     MICROSOFT STORE CERTIFICATE                         ?
??????????????????????????????????????????????????????????????????????????
Publisher:   CN=5DB9918C-386B-4DCF-98CB-FF6BA76EA289
Thumbprint:  [Managed by Microsoft]
Hash:        _n8ws8gp0q633w
Issuer:      Microsoft Corporation
Valid For:   Microsoft Store distribution only
Stored In:   Microsoft's certification infrastructure

Key Difference: The Subject/Publisher field is completely different,
                which results in a different hash, which results in
                a different Package Family Name.


????????????????????????????????????????????????????????????????????????????
?                          SOLUTION SUMMARY                                 ?
????????????????????????????????????????????????????????????????????????????

Problem:
  You signed the package with your dev certificate (CN=MC-BDS)
  ?
  This created the wrong Package Family Name (_47q1101p6hvwy)
  ?
  Store expects a different one (_n8ws8gp0q633w)
  ?
  ? Identity mismatch error

Solution:
  Use Visual Studio to create the Store package
  ?
  It creates a test-signed or unsigned package
  ?
  Upload the .msixupload bundle to Partner Center
  ?
  Microsoft signs it with the Store certificate during certification
  ?
  This creates the correct Package Family Name (_n8ws8gp0q633w)
  ?
  ? Identity matches, certification proceeds


Follow STORE_SUBMISSION_CHECKLIST.md for step-by-step instructions!
```
